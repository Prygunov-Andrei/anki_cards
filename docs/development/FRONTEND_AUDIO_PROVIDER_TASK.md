# Задание для фронтенда: Выбор провайдера генерации аудио

## Обзор

Добавлена возможность выбора провайдера генерации аудио для всех языков:
- **OpenAI TTS** — платный, 6 голосов на выбор
- **Google TTS (gTTS)** — бесплатный, 1 голос на язык

## API изменения

### Эндпоинт: `POST /api/media/generate-audio/`

**Новый параметр (опциональный):**
```typescript
{
  word: string;
  language: string;
  provider?: 'openai' | 'gtts';  // НОВОЕ: выбор провайдера
  word_id?: number;
}
```

**Ответ (без изменений):**
```typescript
{
  audio_url: string;
  audio_id: string;
  file_path: string;
}
```

### Профиль пользователя: `GET /api/users/profile/`

**Новое поле:**
```typescript
{
  // ... другие поля
  audio_provider: 'openai' | 'gtts';  // НОВОЕ
}
```

**Обновление профиля: `PATCH /api/users/profile/`**
```typescript
{
  audio_provider?: 'openai' | 'gtts';  // НОВОЕ
}
```

## Что нужно реализовать

### 1. Добавить выбор провайдера аудио в настройках

**Местоположение:** Настройки пользователя / Профиль

**UI компонент:**
- Радио-кнопки или селект для выбора провайдера:
  - `OpenAI TTS` (платный, 6 голосов)
  - `Google TTS (gTTS)` (бесплатный, 1 голос)

**Сохранение:**
- При изменении отправлять `PATCH /api/users/profile/` с `audio_provider`
- Сохранять в профиле пользователя

### 2. Подсказка для португальского языка

**Когда показывать:**
- При выборе языка `pt` (португальский)
- При генерации аудио для португальских слов

**Текст подсказки:**
```
⚠️ Внимание: При использовании OpenAI TTS для португальского языка возможны проблемы с качеством европейского португальского. Рекомендуется использовать Google TTS (gTTS) для лучшего результата.
```

**Где показывать:**
1. В настройках при выборе `audio_provider = 'openai'` и `language = 'pt'`
2. В форме генерации аудио, если выбран португальский язык и провайдер OpenAI

### 3. Установка значения по умолчанию для португальского

**Логика:**
- При выборе португальского языка (`pt`) в форме генерации:
  - Если `audio_provider` не установлен или равен `'openai'`
  - Автоматически устанавливать `'gtts'`
  - Показывать подсказку (см. выше)

**Пример:**
```typescript
const handleLanguageChange = (language: string) => {
  if (language === 'pt') {
    // Для португальского по умолчанию используем gTTS
    if (!audioProvider || audioProvider === 'openai') {
      setAudioProvider('gtts');
      showPortugueseWarning();
    }
  }
};
```

### 4. Обновить форму генерации аудио

**Добавить:**
- Поле выбора провайдера (если не установлен в настройках)
- Показывать выбранный провайдер из настроек пользователя
- Позволять переопределить провайдер для конкретной генерации

**Пример структуры:**
```typescript
interface AudioGenerationForm {
  word: string;
  language: string;
  provider?: 'openai' | 'gtts';  // Опционально, берется из профиля
  word_id?: number;
}
```

### 5. Обновить сервис

**В `frontend/src/services/deck.service.ts`:**

```typescript
async generateAudio(data: {
  word: string;
  language: string;
  provider?: 'openai' | 'gtts';  // НОВОЕ
  word_id?: number;
}): Promise<{ audio_url: string; audio_id: string; file_path: string }> {
  const response = await api.post('/api/media/generate-audio/', data);
  return response.data;
}
```

### 6. Обновить компонент настроек

**Добавить поле `audio_provider` в форму настроек пользователя:**

```typescript
<Select
  label="Провайдер генерации аудио"
  value={audioProvider}
  onChange={setAudioProvider}
  options={[
    { value: 'openai', label: 'OpenAI TTS (платный, 6 голосов)' },
    { value: 'gtts', label: 'Google TTS (бесплатный, 1 голос)' }
  ]}
/>

{/* Подсказка для португальского */}
{learningLanguage === 'pt' && audioProvider === 'openai' && (
  <Alert type="warning">
    ⚠️ Внимание: При использовании OpenAI TTS для португальского языка 
    возможны проблемы с качеством европейского португальского. 
    Рекомендуется использовать Google TTS (gTTS) для лучшего результата.
  </Alert>
)}
```

## Важные моменты

1. **Стоимость:**
   - OpenAI TTS: списываются токены
   - gTTS: бесплатно (не списываются токены)

2. **По умолчанию:**
   - Для всех языков: `'openai'`
   - Для португальского: автоматически `'gtts'` (если не установлен явно другой)

3. **Подсказка:**
   - Показывать только для португальского языка
   - Показывать при выборе OpenAI TTS для португальского

4. **Обратная совместимость:**
   - Если `provider` не указан, используется значение из профиля пользователя
   - Если в профиле не установлено, используется `'openai'`

## Тестирование

1. ✅ Выбор провайдера в настройках сохраняется
2. ✅ При генерации аудио используется выбранный провайдер
3. ✅ Для португальского по умолчанию устанавливается gTTS
4. ✅ Подсказка показывается для португальского при выборе OpenAI
5. ✅ gTTS не списывает токены
6. ✅ OpenAI TTS списывает токены

