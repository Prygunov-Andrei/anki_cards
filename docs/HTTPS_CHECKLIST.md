# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ HTTPS

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

**–ü–æ—Ä—Ç 443 –Ω–µ —Å–ª—É—à–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** - —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ:
- –õ–∏–±–æ Cloudflare –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –õ–∏–±–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Cloudflare –≤—ã–∫–ª—é—á–µ–Ω–æ
- –õ–∏–±–æ SSL/TLS —Ä–µ–∂–∏–º –≤ Cloudflare –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

## üìã –ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ (–ø–æ –ø–æ—Ä—è–¥–∫—É)

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Cloudflare (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

#### –®–∞–≥ 1.1: –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å Cloudflare
- –û—Ç–∫—Ä–æ–π—Ç–µ https://dash.cloudflare.com
- –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º–µ–Ω `get-anki.fun`

#### –®–∞–≥ 1.2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **DNS** ‚Üí **Records**
- –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø–∏—Å—å –¥–ª—è `www.get-anki.fun` –∏–ª–∏ `get-anki.fun`
- **–í–ê–ñ–ù–û:** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å **–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ** ‚òÅÔ∏è (–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ)
- –ï—Å–ª–∏ –æ–±–ª–∞–∫–æ **—Å–µ—Ä–æ–µ** ‚ö™ - –≤–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –æ–±–ª–∞–∫–æ)

#### –®–∞–≥ 1.3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL/TLS —Ä–µ–∂–∏–º
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SSL/TLS** ‚Üí **Overview**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∂–∏–º SSL/TLS:
  - ‚ùå **Off** - HTTPS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
  - ‚ùå **Flexible** - Cloudflare ‚Üí –°–µ—Ä–≤–µ—Ä (HTTP) - –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
  - ‚úÖ **Full** - Cloudflare ‚Üí –°–µ—Ä–≤–µ—Ä (HTTPS) - –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø
  - ‚úÖ **Full (strict)** - Cloudflare ‚Üí –°–µ—Ä–≤–µ—Ä (HTTPS —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π) - –õ–£–ß–®–ò–ô

**–î–ï–ô–°–¢–í–ò–ï:** –ï—Å–ª–∏ —Ä–µ–∂–∏–º "Off" –∏–ª–∏ "Flexible" - –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ **"Full"**

#### –®–∞–≥ 1.4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Always Use HTTPS
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SSL/TLS** ‚Üí **Edge Certificates**
- –í–∫–ª—é—á–∏—Ç–µ **"Always Use HTTPS"** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω–æ)

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS (–µ—Å–ª–∏ Cloudflare –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –≤—ã –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Cloudflare, –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSL –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cloudflare (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ Cloudflare
2. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω
3. –ò–∑–º–µ–Ω–∏—Ç–µ NS –∑–∞–ø–∏—Å–∏ —É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–∞ –Ω–∞ Cloudflare
4. –í–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ)
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SSL/TLS —Ä–µ–∂–∏–º = "Full"

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Certbot)
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Certbot –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç Let's Encrypt
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx –¥–ª—è HTTPS
4. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 443 –≤ firewall

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–í—Å–µ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- ‚úÖ `ALLOWED_HOSTS` —Å–æ–¥–µ—Ä–∂–∏—Ç `www.get-anki.fun`
- ‚úÖ `CSRF_TRUSTED_ORIGINS` —Å–æ–¥–µ—Ä–∂–∏—Ç `https://www.get-anki.fun`
- ‚úÖ `SECURE_PROXY_SSL_HEADER` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Nginx –ø–µ—Ä–µ–¥–∞–µ—Ç `X-Forwarded-Proto`

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ Cloudflare:

```bash
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
curl -I https://www.get-anki.fun/admin/

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
# HTTP/1.1 302 Found
# Location: /admin/login/?next=/admin/
```

## üéØ –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Cloudflare:**

1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å Cloudflare
2. DNS ‚Üí Records ‚Üí –≤–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ) –¥–ª—è `www.get-anki.fun`
3. SSL/TLS ‚Üí Overview ‚Üí –∏–∑–º–µ–Ω–∏—Ç–µ —Ä–µ–∂–∏–º –Ω–∞ **"Full"**
4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: https://www.get-anki.fun/admin/

**–ï—Å–ª–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Cloudflare:**

–ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSL –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `docs/HTTPS_SETUP.md`

## üìû –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Cloudflare (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
2. –ï—Å–ª–∏ Cloudflare –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - —Ä–µ—à–∏—Ç–µ, —Ö–æ—Ç–∏—Ç–µ –ª–∏ –≤—ã –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
3. –ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cloudflare - –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSL –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ Cloudflare

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –æ—Ç–≤–µ—Ç–∞
curl -I https://www.get-anki.fun/

# –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ "CF-Ray" - Cloudflare –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
# –ï—Å–ª–∏ –Ω–µ—Ç - Cloudflare –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

