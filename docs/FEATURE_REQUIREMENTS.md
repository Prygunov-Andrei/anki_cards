# Требования к новым функциям

**Дата создания:** 13 ноября 2024

## Общая концепция

### Мультиязычность
- Приложение должно поддерживать несколько языков интерфейса
- Пользователь выбирает **родной язык** (основной язык интерфейса)
- Все запросы к LLM идут на родном языке пользователя
- Промпты для генерации медиа настраиваемые пользователем

### Основные понятия

1. **Основной язык (родной язык)** - язык интерфейса и общения с LLM
   - По умолчанию: русский
   - Выбирается пользователем в профиле

2. **Язык изучения** - язык, на котором создаются карточки
   - Текущие варианты: португальский, немецкий
   - Выбирается пользователем в профиле

---

## 1. Страница профиля пользователя

### Функциональность

#### 1.1. Личные данные
- [ ] Поле "Имя" (текстовое)
- [ ] Поле "Фамилия" (текстовое)
- [ ] Загрузка фото профиля (изображение)
- [ ] Предпросмотр загруженного фото

#### 1.2. Настройки языков
- [ ] Выбор основного языка (родного языка)
  - Варианты: русский, английский, и др. (список расширяемый)
  - По умолчанию: русский
- [ ] Выбор языка изучения
  - Варианты: португальский, немецкий
  - Возможно расширение в будущем

#### 1.3. Визуальные настройки
- [ ] Логотип приложения - флаг страны изучаемого языка
  - Автоматически меняется при смене языка изучения
- [ ] Выбор темы: светлая/темная
- [ ] Сохранение настроек темы

#### 1.4. Настройка промптов (редактируемые промпты)
- [ ] Промпт для генерации изображений
  - Редактируемое текстовое поле
  - Кнопка "Сбросить до заводских настроек"
  - Отображается на родном языке пользователя
- [ ] Промпт для генерации аудио
  - Редактируемое текстовое поле
  - Кнопка "Сбросить до заводских настроек"
  - Отображается на родном языке пользователя
- [ ] Промпт для анализа слов (если слова на разных языках)
  - Редактируемое текстовое поле
  - Кнопка "Сбросить до заводских настроек"
- [ ] Промпт для перевода слов
  - Редактируемое текстовое поле
  - Кнопка "Сбросить до заводских настроек"

**Важно:** Пользователь видит и редактирует только смысловую текстовую часть промптов. JSON структура скрыта.

---

## 2. Улучшение ввода слов

### 2.1. Форматирование ввода

**Правила парсинга:**
- Запятая разделяет слова или словосочетания
- Словосочетания - единый объект (первое слово с заглавной буквы)
- Точки игнорируются
- Слова можно давать вперемешку

**Примеры:**
```
Ввод: "casa, Carro novo, tempo, Vida boa"
Результат: ["casa", "Carro novo", "tempo", "Vida boa"]
```

### 2.2. Анализ смешанных языков

**Логика:**
- Если в списке есть слова на разных языках (изучаемом и родном):
  - Запускается анализ через LLM
  - Используется строго заданный промпт
  - LLM возвращает JSON с переводами
  - Переводы предзаполняются в форме

**Если переводов недостаточно:**
- Автоматически запускается перевод недостающих слов
- Используется промпт для перевода

---

## 3. Специфика для немецкого языка

### 3.1. Обработка существительных
- Все существительные в единственном числе пишутся с большой буквы
- Автоматическое добавление артиклей: die, der, das
- Определение артикля через LLM или правила

**Пример:**
```
Ввод: "haus"
Результат: "das Haus"
```

---

## 4. Упрощенный режим

### 4.1. Особенности
- Только ввод массива слов
- **Ввод картинкой с распознаванием текста через LLM Vision API**
  - Поддержка рукописного текста
  - Поддержка текста под разными углами
  - Использование GPT-4 Vision или аналогичной модели
- Все LLM запускаются автоматически
- Минимум подтверждений от пользователя

### 4.2. Автоматическая генерация названия колоды
- После вставки и анализа слов
- Генерация через LLM на основе списка слов
- Учитываются категории и части речи

### 4.3. Контекст для LLM
- Все возможные части речи изучаемого языка:
  - Существительное, глагол, местоимение
  - Прошедшее время и другие грамматические конструкции
  - Разные промпты для разных языков
  - **Определение части речи через LLM** (не локальные правила)
- ~100 категорий (спорт, путешествие, жилище и т.д.)
- **Категории определяются автоматически через LLM** (не предопределенный список)

---

## 5. Сложный режим

### 5.1. Особенности
- Все действия требуют подтверждения пользователя
- Пользователь контролирует каждый шаг
- Текущий режим работы приложения

---

## 6. Улучшения генерации изображений

### 6.1. Требования к промпту
- **Важно:** На картинке не должно быть никаких лишних надписей на непонятных языках
- На картинке должно быть само слово (на языке изучения)
- В яркой желтой подложке - мелкий перевод на английский (независимо от выбранных языков)
- **Для абстрактных понятий LLM должна решить, что применить в качестве картинки (символ, метафора, визуализация)**

**Пример промпта:**
```
"Простое, четкое изображение слова '{word}' ({translation} на русском). 
Стиль: минималистичный, образовательный, без текста.
На изображении должно быть само слово '{word}' крупно.
В яркой желтой подложке мелко написать английский перевод '{english_translation}'.
Никаких других надписей или символов."
```

### 6.2. Цветовая схема по частям речи

**Сторона карточки с иностранным словом:**
- **Глаголы:** холодные тона - синий, темно-синий (если неправильный глагол), зеленоватые
- **Существительные:** электрик цвета
- **Прилагательные:** электрик цвета
- **Остальные части речи:** случайные цвета

**Реализация:**
- Определение части речи через LLM
- **Применение соответствующей цветовой схемы к самой картинке** (не к фону карточки)
- Цветовая схема передается в промпт для DALL-E

---

## 7. Улучшения генерации аудио

### 7.1. Разнообразие голосов
- Случайный выбор голоса для каждого слова:
  - Женский голос
  - Мужской голос
  - **Детский голос (для всех языков)**
- **Вариация громкости:** в пределах 50% от стандартной громкости (случайно)

### 7.2. Настройки по частям речи
- **Глаголы:** быстрее и эмоциональнее
- **Остальные:** стандартная скорость и эмоциональность

---

## 8. Удаление переключения языка

### 8.1. Изменения в интерфейсе
- Убрать переключатель языка на странице загрузки слов
- Язык изучения берется из профиля пользователя
- Отображается только для информации (read-only)

---

## 9. Темная/светлая тема

### 9.1. Реализация
- Переключатель темы в профиле
- Сохранение выбора в настройках пользователя
- Применение темы ко всему приложению

---

## Технические детали

### Промпты для LLM

#### Промпт для анализа смешанных слов
```
Ты получаешь список слов на разных языках.
Определи, какие слова на языке изучения ({learning_language}), 
а какие на родном языке ({native_language}).
Верни JSON с парами: {"слово_на_изучаемом": "перевод_на_родном"}
```

#### Промпт для перевода
```
Переведи следующие слова с {learning_language} на {native_language}.
Верни JSON: {"слово": "перевод"}
```

#### Промпт для генерации названия колоды
```
На основе списка слов на {learning_language} сгенерируй 
краткое и понятное название колоды на {native_language}.
Учти категории и тематику слов.
```

#### Промпт для определения части речи (немецкий)
```
Определи часть речи и артикль для немецкого слова "{word}".
Верни JSON: {"part_of_speech": "...", "article": "der|die|das", "capitalized": "..."}
```

---

## Приоритеты реализации

### Высокий приоритет
1. Страница профиля с настройками языков
2. Улучшение промптов для генерации изображений
3. Улучшение форматирования ввода слов
4. Анализ смешанных языков

### Средний приоритет
5. Упрощенный режим
6. Цветовая схема по частям речи
7. Улучшение генерации аудио

### Низкий приоритет
8. Темная/светлая тема
9. Ввод слов картинкой (OCR через Vision API)

