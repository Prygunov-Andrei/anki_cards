# Anki Card Generator (Backend)

[![GitHub](https://img.shields.io/badge/GitHub-Repository-blue)](https://github.com/Prygunov-Andrei/anki_cards)

Backend ะดะปั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะณะตะฝะตัะฐัะธะธ ะบะฐััะพัะตะบ Anki.

## ะะฟะธัะฐะฝะธะต

Backend ะพะฑะตัะฟะตัะธะฒะฐะตั API ะดะปั:
- ะฃะฟัะฐะฒะปะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ ะธ ะฐััะตะฝัะธัะธะบะฐัะธะธ
- ะะตะฝะตัะฐัะธะธ ะบะฐััะพัะตะบ Anki (.apkg)
- ะะฝัะตะณัะฐัะธะธ ั OpenAI (DALL-E 3, TTS-1-HD) ะธ Google Gemini (Nano Banana) ะดะปั ะณะตะฝะตัะฐัะธะธ ะผะตะดะธะฐ
- ะฃะฟัะฐะฒะปะตะฝะธั ะฑะธะฑะปะธะพัะตะบะพะน ัะปะพะฒ

**ะคัะพะฝัะตะฝะด:** ะะฝัะตะณัะธัะพะฒะฐะฝ ะฒ ะฟัะพะตะบั (ัะผ. [ะะฝััััะบัะธะธ ะฟะพ ะทะฐะฟััะบั](./frontend/README.md)).

## ะะพะบัะผะตะฝัะฐัะธั

- **[ะะปะฐะฝ ัะฐะทัะฐะฑะพัะบะธ Backend](./docs/DEVELOPMENT_PLAN.md)** โ ะฟะปะฐะฝ Backend ัะฐะทัะฐะฑะพัะบะธ (ะทะฐะฒะตััะตะฝ)
- **[ะขะตัะฝะธัะตัะบะพะต ะทะฐะดะฐะฝะธะต Frontend](./docs/FRONTEND_TASKS.md)** โ ะฟะพะปะฝะพะต ะขะ ะดะปั Frontend ัะฐะทัะฐะฑะพััะธะบะฐ (18 ััะฐะฟะพะฒ)
- **[Workflow ัะฐะทัะฐะฑะพัะบะธ](./docs/WORKFLOW_QUICK_START.md)** โ ะบะฐะบ ัะฐะฑะพัะฐัั ั Frontend (Figma Make) + Backend (ะปะพะบะฐะปัะฝะพ) โญ
- **[ะะตะฟะปะพะน](./docs/DEPLOYMENT.md)** โ ะฟะพะปะฝะฐั ะธะฝััััะบัะธั ะฟะพ ะดะตะฟะปะพั ั Docker ๐
- **[ะะธะณัะฐัะธั ะดะฐะฝะฝัั](./docs/DATA_MIGRATION.md)** โ ัะพะทะดะฐะฝะธะต ะฑัะบะฐะฟะฐ ะธ ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ะดะฐะฝะฝัั ๐ฆ

## ะัััััะน ััะฐัั (Backend)

### ะขัะตะฑะพะฒะฐะฝะธั
- Python 3.10+
- PostgreSQL 12+ (ะธะปะธ SQLite)

### ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั (.env)

1. ะกะบะพะฟะธััะนัะต ะฟัะธะผะตั ัะฐะนะปะฐ:
   ```bash
   cd backend
   cp .env.example .env
   ```

2. ะะฑัะทะฐัะตะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต ะฒ `.env`:
   ```env
   # ะกะตะบัะตัะฝัะน ะบะปัั Django
   SECRET_KEY=your_secret_key
   
   # OpenAI API Key (ะะะฏะะะขะะะฌะะ ะดะปั ะณะตะฝะตัะฐัะธะธ ะผะตะดะธะฐ!)
   # ะะพะปััะธัั ะบะปัั: https://platform.openai.com/api-keys
   OPENAI_API_KEY=sk-proj-...
   
   # Google Gemini API Key (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะดะปั ะฐะปััะตัะฝะฐัะธะฒะฝะพะน ะณะตะฝะตัะฐัะธะธ ะธะทะพะฑัะฐะถะตะฝะธะน)
   # ะะพะปััะธัั ะบะปัั: https://ai.google.dev/
   GEMINI_API_KEY=AIzaSy...
   ```

3. ะะฟัะธะพะฝะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต:
   ```env
   # ะะฐะทะฐ ะดะฐะฝะฝัั (ะฟะพ ัะผะพะปัะฐะฝะธั SQLite)
   # DATABASE_URL=postgresql://user:password@localhost:5432/anki_db
   
   # ะัะปะฐะดะบะฐ
   DEBUG=True
   
   # ะฅะพััั
   ALLOWED_HOSTS=localhost,127.0.0.1
   ```

### ะะฐะฟััะบ

```bash
./start.sh
```

ะกะบัะธะฟั ัะพะทะดะฐัั ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต, ัััะฐะฝะพะฒะธั ะทะฐะฒะธัะธะผะพััะธ, ะฟัะธะผะตะฝะธั ะผะธะณัะฐัะธะธ ะธ ะทะฐะฟัััะธั ัะตัะฒะตั ะฝะฐ http://localhost:8000.

### ะะฐะทัะฐะฑะพัะบะฐ ั ััะพะฝัะตะฝะดะพะผ (ngrok)

ะะปั ะฟะพะดะบะปััะตะฝะธั ะพะฑะปะฐัะฝะพะณะพ ััะพะฝัะตะฝะดะฐ (Figma Make) ะบ ะปะพะบะฐะปัะฝะพะผั ะฑัะบะตะฝะดั ะธัะฟะพะปัะทัะตััั **ngrok**:

```bash
# 1. ะะฐะฟัััะธัะต ะฑัะบะตะฝะด
./start.sh
# Django ะทะฐะฟัััะธััั ะฝะฐ http://localhost:8000

# 2. ะะฐะฟัััะธัะต ngrok ััะฝะฝะตะปั (ะฒ ะพัะดะตะปัะฝะพะผ ัะตัะผะธะฝะฐะปะต)
ngrok http 8000
# ngrok ะฒัะดะฐัั ะฟัะฑะปะธัะฝัะน URL, ะฝะฐะฟัะธะผะตั: https://f6c058cfd2ea.ngrok-free.app

# 3. ะัะฟะพะปัะทัะนัะต ะฟัะฑะปะธัะฝัะน URL ะฒ ะฝะฐัััะพะนะบะฐั ััะพะฝัะตะฝะดะฐ:
# BASE_URL: 'https://f6c058cfd2ea.ngrok-free.app/api/'
```

> **ะัะธะผะตัะฐะฝะธะต:** ngrok URL ะผะตะฝัะตััั ะฟัะธ ะบะฐะถะดะพะผ ะฟะตัะตะทะฐะฟััะบะต. ะขะตะบััะธะน URL ะผะพะถะฝะพ ัะทะฝะฐัั:
> - ะ ะบะพะฝัะพะปะธ ngrok
> - ะงะตัะตะท `curl http://localhost:4040/api/tunnels`

ะะพะดัะพะฑะฝะตะต ัะผ. [ะขะตัะฝะธัะตัะบะพะต ะทะฐะดะฐะฝะธะต Frontend](./docs/FRONTEND_TASKS.md#ะฟะพะดะบะปััะตะฝะธะต-ะบ-backend-ngrok).

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
anki-card-generator/
โโโ backend/              # Django ะฟัะพะตะบั
โโโ frontend/             # React + Vite ััะพะฝัะตะฝะด
โ   โโโ src/                  # ะััะพะดะฝัะน ะบะพะด
โ   โโโ package.json          # ะะฐะฒะธัะธะผะพััะธ
โ   โโโ vite.config.ts        # ะะพะฝัะธะณััะฐัะธั Vite
โโโ docs/                 # ะะพะบัะผะตะฝัะฐัะธั
โ   โโโ DEVELOPMENT_PLAN.md   # ะะปะฐะฝ Backend ัะฐะทัะฐะฑะพัะบะธ
โ   โโโ FRONTEND_TASKS.md     # ะขะ ะดะปั Frontend
โ   โโโ DEPLOYMENT.md         # ะะฝัะพัะผะฐัะธั ะพ ะดะตะฟะปะพะต
โโโ nginx/                # ะะพะฝัะธะณััะฐัะธั Nginx
โ   โโโ nginx.conf            # Production ะบะพะฝัะธะณ
โ   โโโ nginx.dev.conf        # Development ะบะพะฝัะธะณ
โโโ start.sh              # ะกะบัะธะฟั ะทะฐะฟััะบะฐ ะฑัะบะตะฝะดะฐ
โโโ README.md             # ะญัะพั ัะฐะนะป
```

---

## ะััะธัะตะบัััะฐ

### ะะฑัะฐั ะฐััะธัะตะบัััะฐ

ะัะธะปะพะถะตะฝะธะต ะฟะพัััะพะตะฝะพ ะฟะพ ะฟัะธะฝัะธะฟั ะบะปะธะตะฝั-ัะตัะฒะตัะฝะพะน ะฐััะธัะตะบัััั:

```
โโโโโโโโโโโโโโโ         HTTP/REST API         โโโโโโโโโโโโโโโ
โ   Frontend  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโบ โ   Backend   โ
โ   (React)   โ                               โ   (Django)  โ
โโโโโโโโโโโโโโโ                               โโโโโโโโโโโโโโโ
                                                      โ
                                                      โผ
                                              โโโโโโโโโโโโโโโ
                                              โ  PostgreSQL โ
                                              โโโโโโโโโโโโโโโ
```

### Backend ะฐััะธัะตะบัััะฐ

#### ะกัััะบัััะฐ ะฟัะธะปะพะถะตะฝะธะน

```
backend/
โโโ apps/
โ   โโโ users/          # ะััะตะฝัะธัะธะบะฐัะธั ะธ ัะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
โ   โ   โโโ models.py   # ะะพะดะตะปั User (ัะฐััะธัะตะฝะธะต ััะฐะฝะดะฐััะฝะพะน)
โ   โ   โโโ views.py    # API views ะดะปั ัะตะณะธัััะฐัะธะธ/ะฒัะพะดะฐ
โ   โ   โโโ serializers.py
โ   โ   โโโ urls.py
โ   โ
โ   โโโ words/          # ะฃะฟัะฐะฒะปะตะฝะธะต ัะปะพะฒะฐะผะธ
โ   โ   โโโ models.py   # ะะพะดะตะปั Word
โ   โ   โโโ views.py    # API ะดะปั ัะฐะฑะพัั ัะพ ัะปะพะฒะฐะผะธ
โ   โ   โโโ serializers.py
โ   โ   โโโ urls.py
โ   โ
โ   โโโ cards/          # ะะตะฝะตัะฐัะธั ะบะฐััะพัะตะบ Anki
โ       โโโ views.py    # API ะดะปั ะณะตะฝะตัะฐัะธะธ .apkg
โ       โโโ utils.py    # ะฃัะธะปะธัั ะดะปั ัะฐะฑะพัั ั genanki
โ       โโโ urls.py
โ
โโโ config/
    โโโ settings.py     # ะะฐัััะพะนะบะธ Django
    โโโ urls.py         # ะะปะฐะฒะฝัะน URL router
```

#### ะะพัะพะบ ะดะฐะฝะฝัั

1. **ะะตะณะธัััะฐัะธั/ะัะพะด:**
   - Frontend โ POST `/api/auth/register/` ะธะปะธ `/api/auth/login/`
   - Backend โ ะกะพะทะดะฐะฝะธะต/ะฟัะพะฒะตัะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
   - Backend โ ะะพะทะฒัะฐั ัะพะบะตะฝะฐ
   - Frontend โ ะกะพััะฐะฝะตะฝะธะต ัะพะบะตะฝะฐ ะฒ localStorage

2. **ะะตะฝะตัะฐัะธั ะผะตะดะธะฐัะฐะนะปะพะฒ (ะพะฟัะธะพะฝะฐะปัะฝะพ):**
   - Frontend โ POST `/api/media/generate-image/` ะธะปะธ `/api/media/generate-audio/` (ั ัะพะบะตะฝะพะผ)
   - Backend โ ะัะทะพะฒ OpenAI API (DALL-E 3 ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน, TTS-1-HD ะดะปั ะฐัะดะธะพ) ะธะปะธ Google Gemini API (Nano Banana ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน)
   - ะัะพะฒะฐะนะดะตั ะฒัะฑะธัะฐะตััั ะธะท ะฝะฐัััะพะตะบ ะฟะพะปัะทะพะฒะฐัะตะปั ะธะปะธ ะผะพะถะตั ะฑััั ัะบะฐะทะฐะฝ ะฒ ะทะฐะฟัะพัะต
   - Backend โ ะกะพััะฐะฝะตะฝะธะต ะผะตะดะธะฐัะฐะนะปะฐ ะปะพะบะฐะปัะฝะพ
   - Backend โ ะะพะทะฒัะฐั URL ะบ ะผะตะดะธะฐัะฐะนะปั
   - Frontend โ ะัะตะดะฟัะพัะผะพัั ะผะตะดะธะฐัะฐะนะปะฐ

3. **ะะตะฝะตัะฐัะธั ะบะฐััะพัะตะบ:**
   - Frontend โ POST `/api/cards/generate/` (ั ัะพะบะตะฝะพะผ, ัะปะพะฒะฐะผะธ, ะฟะตัะตะฒะพะดะฐะผะธ, ะผะตะดะธะฐัะฐะนะปะฐะผะธ)
   - Backend โ ะะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั
   - Backend โ ะกะพััะฐะฝะตะฝะธะต ัะปะพะฒ ะฒ ะะ
   - Backend โ ะะตะฝะตัะฐัะธั .apkg ัะตัะตะท genanki (ะฒะบะปััะฐั ะผะตะดะธะฐัะฐะนะปั)
   - Backend โ ะะพะทะฒัะฐั ัััะปะบะธ ะฝะฐ ัะบะฐัะธะฒะฐะฝะธะต
   - Frontend โ GET `/api/cards/download/<file_id>/`
   - Frontend โ ะกะบะฐัะธะฒะฐะฝะธะต ัะฐะนะปะฐ

### ะะฐะทะฐ ะดะฐะฝะฝัั

#### ะกัะตะผะฐ

```
User
โโโ id (PK)
โโโ username
โโโ email
โโโ password (hashed)
โโโ preferred_language
โโโ created_at

Word
โโโ id (PK)
โโโ user (FK โ User)
โโโ original_word
โโโ translation
โโโ language
โโโ audio_file (nullable)
โโโ image_file (nullable)
โโโ created_at
โโโ updated_at

Index: (user, original_word, language) - unique
```

### ะคะพัะผะฐั ัะฐะนะปะพะฒ Anki (.apkg)

- **ะะดะธะฝ .apkg ัะฐะนะป = ะพะดะฝะฐ ะบะพะปะพะดะฐ ะบะฐััะพัะตะบ** (ะผะพะถะตั ัะพะดะตัะถะฐัั ะผะฝะพะถะตััะฒะพ ะบะฐััะพัะตะบ)
- ะคะฐะนะป .apkg ะฟัะตะดััะฐะฒะปัะตั ัะพะฑะพะน ZIP-ะฐััะธะฒ, ัะพะดะตัะถะฐัะธะน ะฑะฐะทั ะดะฐะฝะฝัั SQLite ะธ ะผะตะดะธะฐัะฐะนะปั.
- **ะะพะปะพะดะฐ ะพะฑัะทะฐัะตะปัะฝะพ ะดะพะปะถะฝะฐ ะธะผะตัั ะฝะฐะทะฒะฐะฝะธะต** ะฟัะธ ัะพะทะดะฐะฝะธะธ.
- ะะปั ัะพะทะดะฐะฝะธั .apkg ัะฐะนะปะพะฒ ะธัะฟะพะปัะทัะตััั ะฑะธะฑะปะธะพัะตะบะฐ `genanki` (Python).

### ะะพะดะตะปะธ ะดะปั ะณะตะฝะตัะฐัะธะธ ะผะตะดะธะฐ

- **OpenAI:**
  - **ะะทะพะฑัะฐะถะตะฝะธั:** DALL-E 3 (`dall-e-3`)
  - **ะัะดะธะพ:** TTS-1-HD (`tts-1-hd`)
- **Google Gemini:**
  - **ะะทะพะฑัะฐะถะตะฝะธั:** Nano Banana Pro (`nano-banana-pro-preview`)
  - ะะฐะทะผะตั: 1024x1024
  - ะัะพะผะฟั ัะพัะผะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐ ะพัะฝะพะฒะต ัะปะพะฒะฐ ะธ ะฟะตัะตะฒะพะดะฐ
- **ะัะดะธะพ:** TTS-1-HD (`tts-1-hd`)
  - ะคะพัะผะฐั: MP3
  - ะะพะปะพั ะฒัะฑะธัะฐะตััั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะทัะบะฐ (pt โ ะฟะพัััะณะฐะปััะบะธะน, de โ ะฝะตะผะตัะบะธะน)

---

## API ะะพะบัะผะตะฝัะฐัะธั

### ะะฐะทะพะฒัะน URL

```
http://localhost:8000/api/
```

### ะััะตะฝัะธัะธะบะฐัะธั

ะะพะปััะธะฝััะฒะพ endpoints ััะตะฑััั ะฐััะตะฝัะธัะธะบะฐัะธะธ ัะตัะตะท ัะพะบะตะฝ. ะขะพะบะตะฝ ะฟะตัะตะดะฐะตััั ะฒ ะทะฐะณะพะปะพะฒะบะต:

```
Authorization: Token <your-token>
```

### Endpoints

#### ะััะตะฝัะธัะธะบะฐัะธั

- **POST `/api/auth/register/`** - ะะตะณะธัััะฐัะธั ะฝะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั.
- **POST `/api/auth/login/`** - ะัะพะด ะฟะพะปัะทะพะฒะฐัะตะปั.

#### ะัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั

- **GET `/api/user/profile/`** - ะะพะปััะตะฝะธะต ะฟัะพัะธะปั ัะตะบััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั.
- **PATCH `/api/user/profile/`** - ะะฑะฝะพะฒะปะตะฝะธะต ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั.

#### ะะฐะฑะพัะฐ ัะพ ัะปะพะฒะฐะผะธ

- **GET `/api/words/list/`** - ะะพะปััะตะฝะธะต ัะฟะธัะบะฐ ะฒัะตั ัะปะพะฒ ะฟะพะปัะทะพะฒะฐัะตะปั.

#### ะะตะฝะตัะฐัะธั ะบะฐััะพัะตะบ

- **POST `/api/cards/generate/`** - ะะตะฝะตัะฐัะธั .apkg ัะฐะนะปะฐ ั ะบะฐััะพัะบะฐะผะธ.
  - ะะฐัะฐะผะตัั `image_style`: `minimalistic` (ะผะธะฝะธะผะฐะปะธััะธัะฝัะน), `balanced` (ัะฑะฐะปะฐะฝัะธัะพะฒะฐะฝะฝัะน, ะฟะพ ัะผะพะปัะฐะฝะธั), `creative` (ัะฒะพััะตัะบะธะน).
- **GET `/api/cards/download/<file_id>/`** - ะกะบะฐัะธะฒะฐะฝะธะต ัะณะตะฝะตัะธัะพะฒะฐะฝะฝะพะณะพ .apkg ัะฐะนะปะฐ.

#### ะะตะฝะตัะฐัะธั ะผะตะดะธะฐัะฐะนะปะพะฒ

- **POST `/api/media/generate-image/`** - ะะตะฝะตัะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธั ะดะปั ัะปะพะฒะฐ.
  - ะะพะดะดะตัะถะธะฒะฐะตั ะดะฒะฐ ะฟัะพะฒะฐะนะดะตัะฐ: OpenAI DALL-E 3 (ะฟะพ ัะผะพะปัะฐะฝะธั) ะธ Google Gemini Nano Banana
  - ะะฐัะฐะผะตัั `provider`: `'openai'` ะธะปะธ `'gemini'` (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะตัะปะธ ะฝะต ัะบะฐะทะฐะฝ - ะธัะฟะพะปัะทัะตััั ะธะท ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั)
  - ะะฐัะฐะผะตัั `image_style`: `'minimalistic'`, `'balanced'`, `'creative'`
- **POST `/api/media/generate-audio/`** - ะะตะฝะตัะฐัะธั ะฐัะดะธะพ ะดะปั ัะปะพะฒะฐ ัะตัะตะท OpenAI TTS-1-HD.

#### ะะฐะณััะทะบะฐ ัะพะฑััะฒะตะฝะฝัั ะผะตะดะธะฐัะฐะนะปะพะฒ

- **POST `/api/media/upload-image/`** - ะะฐะณััะทะบะฐ ัะพะฑััะฒะตะฝะฝะพะณะพ ะธะทะพะฑัะฐะถะตะฝะธั.
- **POST `/api/media/upload-audio/`** - ะะฐะณััะทะบะฐ ัะพะฑััะฒะตะฝะฝะพะณะพ ะฐัะดะธะพ.

### ะะพะดั ะพัะธะฑะพะบ

- `400` - Bad Request (ะฝะตะฒะตัะฝัะต ะดะฐะฝะฝัะต)
- `401` - Unauthorized (ััะตะฑัะตััั ะฐััะตะฝัะธัะธะบะฐัะธั)
- `403` - Forbidden (ะฝะตั ะดะพัััะฟะฐ)
- `404` - Not Found (ัะตัััั ะฝะต ะฝะฐะนะดะตะฝ)
- `500` - Internal Server Error (ะพัะธะฑะบะฐ ัะตัะฒะตัะฐ)
