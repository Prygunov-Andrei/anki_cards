# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è

**–î–∞—Ç–∞:** 1 –¥–µ–∫–∞–±—Ä—è 2024  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞, –æ–Ω –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è

---

## üêõ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–ª –∞–≤–∞—Ç–∞—Ä, —Å–æ—Ö—Ä–∞–Ω—è–ª –ø—Ä–æ—Ñ–∏–ª—å, –Ω–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Ñ–∏–ª—è –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ - –∞–≤–∞—Ç–∞—Ä –∏—Å—á–µ–∑–∞–ª.

### –ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:

1. **AvatarUpload –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è —Å prop** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª `preview` —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª –µ–≥–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `currentAvatar` prop

2. **–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ URL –æ—Ç backend** - Django –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∫ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/media/avatars/user_1.jpg`), –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ URL

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—Ç–∏–ª–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å URL** - –Ω–µ –±—ã–ª–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω useEffect –≤ AvatarUpload

**–§–∞–π–ª:** `/components/AvatarUpload.tsx`

```typescript
/**
 * –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è preview —Å currentAvatar prop
 */
useEffect(() => {
  setPreview(currentAvatar || null);
}, [currentAvatar]);
```

–¢–µ–ø–µ—Ä—å –∫–æ–≥–¥–∞ `currentAvatar` –º–µ–Ω—è–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è user –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ), preview –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è.

### 2. –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å url-helpers.ts

**–§–∞–π–ª:** `/utils/url-helpers.ts`

–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö URL –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ:

```typescript
/**
 * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π URL –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π
 * Django —á–∞—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤
 */
export const getAbsoluteUrl = (url: string | null | undefined): string | null => {
  if (!url) return null;

  // –ï—Å–ª–∏ URL —É–∂–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π
  if (url.startsWith('http://') || url.startsWith('https://')) {
    return url;
  }

  // –ï—Å–ª–∏ URL –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å /media/ –∏–ª–∏ /static/
  if (url.startsWith('/media/') || url.startsWith('/static/')) {
    return `${API_BASE_URL}${url}`;
  }

  // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –¥–æ–±–∞–≤–ª—è–µ–º API_BASE_URL
  return `${API_BASE_URL}${url.startsWith('/') ? url : `/${url}`}`;
};

/**
 * –ü–æ–ª—É—á–∏—Ç—å URL –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 */
export const getUserAvatarUrl = (avatarUrl: string | null | undefined): string | null => {
  return getAbsoluteUrl(avatarUrl);
};
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω Header

**–§–∞–π–ª:** `/components/Header.tsx`

```typescript
import { getUserAvatarUrl } from '../utils/url-helpers';

// Desktop –∞–≤–∞—Ç–∞—Ä
<AvatarImage src={getUserAvatarUrl(user?.avatar) || undefined} />

// Mobile –∞–≤–∞—Ç–∞—Ä
<AvatarImage src={getUserAvatarUrl(user?.avatar) || undefined} />

// Mobile burger menu –∞–≤–∞—Ç–∞—Ä
<AvatarImage src={getUserAvatarUrl(user?.avatar) || undefined} />
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω ProfilePage

**–§–∞–π–ª:** `/pages/ProfilePage.tsx`

```typescript
import { getUserAvatarUrl } from '../utils/url-helpers';

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ AvatarUpload
<AvatarUpload
  currentAvatar={getUserAvatarUrl(user?.avatar)}
  onAvatarChange={handleAvatarChange}
  onAvatarRemove={handleAvatarRemove}
/>
```

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª
   - AvatarUpload —Å–æ–∑–¥–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π preview (data URL)
   - –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ProfilePage

2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
   - FormData —Å —Ñ–∞–π–ª–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/api/user/profile/`
   - Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/media/avatars/user_1_abc123.jpg`)

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:**
   - `updateUser()` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
   - –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage
   - User –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞:**
   - `getUserAvatarUrl()` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π
   - –ê–±—Å–æ–ª—é—Ç–Ω—ã–π URL –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `AvatarImage`
   - useEffect –≤ AvatarUpload —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç preview

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è URL:

```typescript
// Backend –≤–µ—Ä–Ω—É–ª –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
user.avatar = "/media/avatars/user_1_abc123.jpg"

// getUserAvatarUrl –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π
getUserAvatarUrl(user.avatar) 
// => "https://spouse-safer-being-luke.trycloudflare.com/media/avatars/user_1_abc123.jpg"

// –£–∂–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π URL - –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è
user.avatar = "https://example.com/avatar.jpg"
getUserAvatarUrl(user.avatar)
// => "https://example.com/avatar.jpg"
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
2. ‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
3. ‚úÖ –£–≤–∏–¥–µ—Ç—å preview
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
5. ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
6. ‚úÖ –ê–≤–∞—Ç–∞—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å (—É–∂–µ –µ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä)
2. ‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ
3. ‚úÖ –£–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–π preview
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
5. ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
6. ‚úÖ –ù–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å (–µ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä)
2. ‚úÖ –ù–∞–∂–∞—Ç—å "–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ"
3. ‚úÖ Placeholder –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
5. ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
6. ‚úÖ Placeholder –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è (–±–µ–∑ –∞–≤–∞—Ç–∞—Ä–∞)

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: Header —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
1. ‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
3. ‚úÖ –ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ Header (Desktop)
4. ‚úÖ –ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ Header (Mobile)
5. ‚úÖ –ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ mobile burger menu
6. ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
7. ‚úÖ –ê–≤–∞—Ç–∞—Ä –≤–µ–∑–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –≤ url-helpers.ts:

- `getAbsoluteUrl()` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ URL
- `getUserAvatarUrl()` - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤
- `getCardImageUrl()` - –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–∞—Ä—Ç–æ—á–µ–∫ (–±—É–¥—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- `getAudioUrl()` - –¥–ª—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ (–±—É–¥—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø—É—Ç–µ–π:

‚úÖ –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å /: `/media/avatars/user.jpg`  
‚úÖ –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –±–µ–∑ /: `media/avatars/user.jpg`  
‚úÖ –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ HTTP: `http://example.com/avatar.jpg`  
‚úÖ –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ HTTPS: `https://example.com/avatar.jpg`  
‚úÖ Static —Ñ–∞–π–ª—ã: `/static/default-avatar.png`

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –ê–≤–∞—Ç–∞—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏  
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–º–∏ URL  
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É ProfilePage –∏ Header  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dark mode  
‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ URL  
‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫, –∞—É–¥–∏–æ)

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `/utils/url-helpers.ts` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å URL

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `/components/AvatarUpload.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω useEffect –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `/components/Header.tsx` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ getUserAvatarUrl
- `/pages/ProfilePage.tsx` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ getUserAvatarUrl

**–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- `/hooks/useAuth.ts` - updateUser —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- `/contexts/AuthContext.tsx` - –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- `/services/profile.service.ts` - API –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! ‚úÖ**