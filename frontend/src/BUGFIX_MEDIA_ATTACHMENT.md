# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ü—Ä–∏–≤—è–∑–∫–∞ –º–µ–¥–∏–∞ –∫ —Å–ª–æ–≤–∞–º –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–ª–æ–¥—ã —á–µ—Ä–µ–∑ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –æ–ø—Ü–∏–µ–π "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ú–æ–∏ –∫–æ–ª–æ–¥—ã":

‚úÖ –ö–æ–ª–æ–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è  
‚úÖ –°–ª–æ–≤–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è  
‚úÖ –ú–µ–¥–∏–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∞—É–¥–∏–æ) –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è  
‚ùå **–ú–µ–¥–∏–∞ –ù–ï –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ —Å–ª–æ–≤–∞–º –≤ –ë–î**

**–°–∏–º–ø—Ç–æ–º:** –í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–ª–æ–¥—ã –≤ —Å—Ç–æ–ª–±—Ü–µ "–ú–µ–¥–∏–∞" —Å—Ç–æ—è—Ç –ø—Ä–æ—á–µ—Ä–∫–∏ –≤–º–µ—Å—Ç–æ –∏–∫–æ–Ω–æ–∫.

---

## –ü—Ä–∏—á–∏–Ω–∞

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   ‚Üí imageFiles = { "cat": "/media/images/xxx.jpg", ... }

2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ
   ‚Üí audioFiles = { "cat": "/media/audio/yyy.mp3", ... }

3. POST /api/cards/generate/
   {
     words: ["cat", "dog"],
     translations: {...},
     image_files: imageFiles,
     audio_files: audioFiles,
     save_to_decks: true
   }
   ‚Üì
4. –ë—ç–∫–µ–Ω–¥ —Å–æ–∑–¥–∞—ë—Ç Deck –∏ Words
   ‚ùå –ù–û –º–µ–¥–∏–∞ –Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ —Å–ª–æ–≤–∞–º!
   
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è { file_id, deck_id }

6. –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–∫–∞—á–∏–≤–∞–µ—Ç .apkg —Ñ–∞–π–ª
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë—ç–∫–µ–Ω–¥ Django –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ `/api/cards/generate/` —Å `save_to_decks: true` —Å–æ–∑–¥–∞—ë—Ç –∫–æ–ª–æ–¥—É –∏ —Å–ª–æ–≤–∞, –Ω–æ **–Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –º–µ–¥–∏–∞** –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `image_files` –∏ `audio_files` –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º `Word` –æ–±—ä–µ–∫—Ç–∞–º.

---

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ –º–µ–¥–∏–∞ **–ø–æ—Å–ª–µ** —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–ª–æ–¥—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
1-3. (–¢–æ –∂–µ —Å–∞–º–æ–µ)

4. –ë—ç–∫–µ–Ω–¥ —Å–æ–∑–¥–∞—ë—Ç Deck –∏ Words
   ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç { file_id, deck_id }

5. –ù–û–í–û–ï: –ü—Ä–∏–≤—è–∑–∫–∞ –º–µ–¥–∏–∞ –∫ —Å–ª–æ–≤–∞–º
   ‚Üì
   5.1. GET /api/cards/decks/{deck_id}/
        ‚Üí –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–æ–¥—É —Å–æ —Å–ª–æ–≤–∞–º–∏ –∏ –∏—Ö ID
   
   5.2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞:
        PATCH /api/cards/decks/{deck_id}/words/{word_id}/
        {
          image_file: imageFiles[word.original_word],
          audio_file: audioFiles[word.original_word]
        }
   
   5.3. –ú–µ–¥–∏–∞ –ø—Ä–∏–≤—è–∑–∞–Ω—ã! ‚úÖ

6. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ .apkg —Ñ–∞–π–ª–∞

7. –£—Å–ø–µ—Ö! –í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–ª–æ–¥—ã –º–µ–¥–∏–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
```

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –§–∞–π–ª: `/pages/MainPage.tsx`

**–õ–æ–∫–∞—Ü–∏—è:** –°—Ç—Ä–æ–∫–∏ 311-343 (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è deck_id)

**–ö–æ–¥:**
```typescript
// –°–æ—Ö—Ä–∞–Ω—è–µ–º deck_id –µ—Å–ª–∏ –∫–æ–ª–æ–¥–∞ –±—ã–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
if (deck_id) {
  setSavedDeckId(deck_id);
  
  // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –º–µ–¥–∏–∞ –∫ —Å–ª–æ–≤–∞–º –≤ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∫–æ–ª–æ–¥–µ
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—É—é –∫–æ–ª–æ–¥—É —Å–æ —Å–ª–æ–≤–∞–º–∏
    const createdDeck = await deckService.getDeck(deck_id);
    
    if (createdDeck.words && createdDeck.words.length > 0) {
      // –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –º–µ–¥–∏–∞
      for (const word of createdDeck.words) {
        const mediaUpdates: { image_file?: string; audio_file?: string } = {};
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞
        if (imageFiles[word.original_word]) {
          mediaUpdates.image_file = imageFiles[word.original_word];
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞—É–¥–∏–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞
        if (audioFiles[word.original_word]) {
          mediaUpdates.audio_file = audioFiles[word.original_word];
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ–¥–∏–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —á—Ç–æ –æ–±–Ω–æ–≤–ª—è—Ç—å
        if (Object.keys(mediaUpdates).length > 0) {
          await deckService.updateWordMedia(deck_id, word.id, mediaUpdates);
        }
      }
    }
  } catch (error) {
    console.error('Error attaching media to saved deck:', error);
    // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å, –º–µ–¥–∏–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
  }
}
```

---

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∫–æ–ª–æ–¥—ã

```typescript
const createdDeck = await deckService.getDeck(deck_id);
```

**API:** `GET /api/cards/decks/{deck_id}/`

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 42,
  "name": "–ñ–∏–≤–æ—Ç–Ω—ã–µ",
  "words": [
    {
      "id": 1,
      "original_word": "cat",
      "translation": "–∫–æ—à–∫–∞",
      "image_file": null,  // ‚Üê –ü–æ–∫–∞ null
      "audio_file": null   // ‚Üê –ü–æ–∫–∞ null
    },
    {
      "id": 2,
      "original_word": "dog",
      "translation": "—Å–æ–±–∞–∫–∞",
      "image_file": null,
      "audio_file": null
    }
  ],
  ...
}
```

---

### 2. –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ —Å–ª–æ–≤–∞–º

```typescript
for (const word of createdDeck.words) {
  const mediaUpdates: { image_file?: string; audio_file?: string } = {};
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
  if (imageFiles[word.original_word]) {
    mediaUpdates.image_file = imageFiles[word.original_word];
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞—É–¥–∏–æ
  if (audioFiles[word.original_word]) {
    mediaUpdates.audio_file = audioFiles[word.original_word];
  }
  
  // ...
}
```

**–ü—Ä–∏–º–µ—Ä:**

–î–ª—è —Å–ª–æ–≤–∞ "cat":
```javascript
imageFiles = {
  "cat": "/media/images/cat_abc123.jpg",
  "dog": "/media/images/dog_def456.jpg"
}

audioFiles = {
  "cat": "/media/audio/cat_ghi789.mp3",
  "dog": "/media/audio/dog_jkl012.mp3"
}

// –î–ª—è word.original_word = "cat"
mediaUpdates = {
  image_file: "/media/images/cat_abc123.jpg",
  audio_file: "/media/audio/cat_ghi789.mp3"
}
```

---

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞

```typescript
if (Object.keys(mediaUpdates).length > 0) {
  await deckService.updateWordMedia(deck_id, word.id, mediaUpdates);
}
```

**API:** `PATCH /api/cards/decks/{deck_id}/words/{word_id}/`

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "image_file": "/media/images/cat_abc123.jpg",
  "audio_file": "/media/audio/cat_ghi789.mp3"
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—è `image_file` –∏ `audio_file` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ –ë–î!

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
try {
  // ... –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ –º–µ–¥–∏–∞ ...
} catch (error) {
  console.error('Error attaching media to saved deck:', error);
  // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å, –º–µ–¥–∏–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
}
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
- ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ù–ï –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ .apkg —Ñ–∞–π–ª —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ –ö–æ–ª–æ–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- ‚ö†Ô∏è –ú–µ–¥–∏–∞ –Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ)
- üìù –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã:

1. **GET /api/cards/decks/{deck_id}/** - 1 –∑–∞–ø—Ä–æ—Å
2. **PATCH /api/cards/decks/{deck_id}/words/{word_id}/** - N –∑–∞–ø—Ä–æ—Å–æ–≤ (–≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤)

**–ü—Ä–∏–º–µ—Ä:**
- –ö–æ–ª–æ–¥–∞ —Å 10 —Å–ª–æ–≤–∞–º–∏ ‚Üí 1 + 10 = **11 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
- –ö–æ–ª–æ–¥–∞ —Å 50 —Å–ª–æ–≤–∞–º–∏ ‚Üí 1 + 50 = **51 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å**

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:

**–í–∞—Ä–∏–∞–Ω—Ç 1 (—Ç–µ–∫—É—â–∏–π):** –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –º–µ–¥–∏–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è  
‚úÖ –ù–∞–¥—ë–∂–Ω–æ  
‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚ùå –ú–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤  

**–í–∞—Ä–∏–∞–Ω—Ç 2 (–¥–ª—è –±—ç–∫–µ–Ω–¥–∞):** –ë—ç–∫–µ–Ω–¥ —Å—Ä–∞–∑—É –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –º–µ–¥–∏–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–ª–æ–¥—ã  
‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ (0 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)  
‚úÖ –ë—ã—Å—Ç—Ä–µ–µ  
‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Django view  

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –±—ç–∫–µ–Ω–¥–∞

### –ò–¥–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (Django):

**–§–∞–π–ª:** `views.py` –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `/api/cards/generate/`

```python
@api_view(['POST'])
def generate_cards(request):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    save_to_decks = request.data.get('save_to_decks', False)
    
    if save_to_decks:
        # –°–æ–∑–¥–∞—Ç—å Deck
        deck = Deck.objects.create(
            name=deck_name,
            user=request.user,
            target_lang=language,
            source_lang='ru',
        )
        
        # –ü–æ–ª—É—á–∏—Ç—å –º–µ–¥–∏–∞ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        image_files = request.data.get('image_files', {})
        audio_files = request.data.get('audio_files', {})
        
        # –°–æ–∑–¥–∞—Ç—å Words —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –º–µ–¥–∏–∞
        for word_text, translation in translations.items():
            Word.objects.create(
                deck=deck,
                original_word=word_text,
                translation=translation,
                language=language,
                image_file=image_files.get(word_text),  # ‚Üê –í–ê–ñ–ù–û!
                audio_file=audio_files.get(word_text),  # ‚Üê –í–ê–ñ–ù–û!
            )
        
        return Response({
            'file_id': file_id,
            'deck_id': deck.id
        })
```

**–° —Ç–∞–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π:** –§—Ä–æ–Ω—Ç–µ–Ω–¥ workaround –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —É–¥–∞–ª–∏—Ç—å!

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º ‚úÖ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ: "cat"
3. –ü–µ—Ä–µ–≤–æ–¥: "–∫–æ—à–∫–∞"
4. –í–∫–ª—é—á–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –∞—É–¥–∏–æ
5. ‚òëÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ "–ú–æ–∏ –∫–æ–ª–æ–¥—ã"
6. –ù–∞–∂–∞—Ç—å "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ .apkg —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω
- ‚úÖ –ö–æ–ª–æ–¥–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –≤ "–ú–æ–∏ –∫–æ–ª–æ–¥—ã"
- ‚úÖ –í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–ª–æ–¥—ã —Å–ª–æ–≤–æ "cat" –∏–º–µ–µ—Ç –º–µ–¥–∏–∞
- ‚úÖ –í —Å—Ç–æ–ª–±—Ü–µ "–ú–µ–¥–∏–∞" –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏–∫–æ–Ω–∫–∏ üñºÔ∏è üîä

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Network:**
```
POST /api/media/generate-image/      (1 —Ä–∞–∑)
POST /api/media/generate-audio/       (1 —Ä–∞–∑)
POST /api/cards/generate/             (1 —Ä–∞–∑)
GET  /api/cards/decks/{deck_id}/      (1 —Ä–∞–∑) ‚Üê –ù–û–í–û–ï!
PATCH /api/cards/decks/{deck_id}/words/1/ (1 —Ä–∞–∑) ‚Üê –ù–û–í–û–ï!
```

---

### –¢–µ—Å—Ç 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ ‚úÖ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å 5 —Å–ª–æ–≤ —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –º–µ–¥–∏–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 5 —Å–ª–æ–≤ —Å –º–µ–¥–∏–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Network:**
```
POST /api/media/generate-image/      (5 —Ä–∞–∑)
POST /api/media/generate-audio/       (5 —Ä–∞–∑)
POST /api/cards/generate/             (1 —Ä–∞–∑)
GET  /api/cards/decks/{deck_id}/      (1 —Ä–∞–∑)
PATCH /api/cards/decks/{deck_id}/words/{id}/ (5 —Ä–∞–∑)
```

---

### –¢–µ—Å—Ç 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑ –º–µ–¥–∏–∞ ‚úÖ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞
2. –û—Ç–∫–ª—é—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∞—É–¥–∏–æ
3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ö–æ–ª–æ–¥–∞ —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –°–ª–æ–≤–∞ –±–µ–∑ –º–µ–¥–∏–∞ (–ø—Ä–æ—á–µ—Ä–∫–∏ –≤ —Å—Ç–æ–ª–±—Ü–µ "–ú–µ–¥–∏–∞")
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Network:**
```
POST /api/cards/generate/             (1 —Ä–∞–∑)
GET  /api/cards/decks/{deck_id}/      (1 —Ä–∞–∑)
# PATCH –∑–∞–ø—Ä–æ—Å–æ–≤ –ù–ï–¢ (—Ç.–∫. imageFiles –∏ audioFiles –ø—É—Å—Ç—ã–µ)
```

---

### –¢–µ—Å—Ç 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ ‚úÖ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–∫–ª—é—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
2. –û—Ç–∫–ª—é—á–∏—Ç—å –∞—É–¥–∏–æ
3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢–æ–ª—å–∫–æ image_file –æ–±–Ω–æ–≤–ª—ë–Ω
- ‚úÖ audio_file –æ—Å—Ç–∞—ë—Ç—Å—è null

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:**
```json
PATCH /api/cards/decks/{deck_id}/words/1/
{
  "image_file": "/media/images/xxx.jpg"
  // audio_file –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
}
```

---

### –¢–µ—Å—Ç 5: –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ –º–µ–¥–∏–∞ ‚ö†Ô∏è

**–°—Ü–µ–Ω–∞—Ä–∏–π:** API updateWordMedia –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
- ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –ù–ï –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ .apkg —Ñ–∞–π–ª —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- ‚ö†Ô∏è –ú–µ–¥–∏–∞ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é)

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: Batch update API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±—ç–∫–µ–Ω–¥–∞)

**–ò–¥–µ—è:** –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–¥–∏–∞

```python
POST /api/cards/decks/{deck_id}/attach_media/
{
  "media": [
    {
      "word_id": 1,
      "image_file": "/media/images/xxx.jpg",
      "audio_file": "/media/audio/yyy.mp3"
    },
    {
      "word_id": 2,
      "image_file": "/media/images/zzz.jpg",
      "audio_file": "/media/audio/aaa.mp3"
    }
  ]
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ 1 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å (–≤—Å–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ)
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–ª—É—á—à–µ–Ω–∏–µ /api/cards/generate/

**–ò–¥–µ—è:** –ë—ç–∫–µ–Ω–¥ —Å—Ä–∞–∑—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç image_files –∏ audio_files

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Django:**
```python
# –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Word –æ–±—ä–µ–∫—Ç–∞
Word.objects.create(
    deck=deck,
    original_word=word,
    translation=translation,
    language=language,
    image_file=image_files.get(word),  # ‚Üê –î–æ–±–∞–≤–∏—Ç—å
    audio_file=audio_files.get(word),  # ‚Üê –î–æ–±–∞–≤–∏—Ç—å
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ 0 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –°–∞–º–æ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ workaround –Ω–µ –Ω—É–∂–µ–Ω

---

## –°—Ç–∞—Ç—É—Å

### ‚úÖ –¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ: –†–ê–ë–û–¢–ê–ï–¢

**–§—Ä–æ–Ω—Ç–µ–Ω–¥:** Workaround —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ–¥–∏–∞ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ —Å–ª–æ–≤–∞–º  
**–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã  

### üéØ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

**–ó–∞–¥–∞—á–∞:** –£–ª—É—á—à–∏—Ç—å `/api/cards/generate/` –Ω–∞ –±—ç–∫–µ–Ω–¥–µ  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (workaround —Ä–∞–±–æ—Ç–∞–µ—Ç)  
**–ü–æ–ª—å–∑–∞:** –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  

---

## –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [x] –ú–µ–¥–∏–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
- [x] –ö–æ–ª–æ–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è
- [x] –°–ª–æ–≤–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
- [x] –ú–µ–¥–∏–∞ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ —Å–ª–æ–≤–∞–º
- [x] –í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏–∫–æ–Ω–∫–∏ –º–µ–¥–∏–∞
- [x] –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
- [x] –†–∞–±–æ—Ç–∞–µ—Ç —Å 1 —Å–ª–æ–≤–æ–º
- [x] –†–∞–±–æ—Ç–∞–µ—Ç —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Å–ª–æ–≤
- [x] –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- [x] –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –∞—É–¥–∏–æ
- [x] –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –º–µ–¥–∏–∞

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–í–µ—Ä—Å–∏—è:** 1.0
