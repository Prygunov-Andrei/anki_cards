"""
Заводские промпты по умолчанию для различных типов операций
"""

# Три режима генерации изображений
IMAGE_PROMPTS = {
    'minimalistic': """Простое, чистое, минималистичное изображение, иллюстрирующее: {translation}. Только один основной объект, без лишних деталей, на светлом фоне. СТРОГО, ОЧЕНЬ ВАЖНО БЕЗ текста, букв, цифр и любых символов.""",
    'balanced': """Выразительная иллюстрация, ясно передающая смысл слова: {translation}. Стиль — нейтральный, умеренно детализированный, с естественными цветами.

Фон может быть светлым или ненавязчивым. СТРОГО, ОЧЕНЬ ВАЖНО БЕЗ текста, букв, цифр и любых символов.""",
    'creative': """Создай яркую, сочную иллюстрацию, которая помогает запомнить значение слова: {translation}. Стиль свободный — может быть минимализм, рисованный арт, живопись, 3D или реалистичность. Разнообразная цветовая палитра, красивый свет, приятные детали. СТРОГО, ОЧЕНЬ ВАЖНО БЕЗ текста, букв, цифр и любых символов.""",
}

DEFAULT_PROMPTS = {
    'image': IMAGE_PROMPTS['balanced'],  # По умолчанию используем сбалансированный режим
    
    'audio': """Произнеси слово '{word}' на языке {language} четко и понятно.""",
    
    'word_analysis': """Ты получаешь список слов на разных языках.
Определи, какие слова на языке изучения ({learning_language}), 
а какие на родном языке ({native_language}).
Верни JSON с парами: {{'слово_на_изучаемом': 'перевод_на_родном'}}""",
    
    'translation': """Переведи следующие слова с {learning_language} на {native_language}.
Верни JSON: {{'слово': 'перевод'}}""",
    
    'deck_name': """На основе списка слов на {learning_language} сгенерируй 
краткое и понятное название колоды на {native_language}.
Учти категории и тематику слов.""",
    
    'category': """Определи категорию для слова '{word}' на языке {language}.
Верни JSON: {{'category': 'название_категории'}}""",
    
    'language_detection': """Определи язык слова '{word}'. 
Верни ТОЛЬКО код языка: 'ru' (русский), 'pt' (португальский), 'de' (немецкий), 'en' (английский).
Если не уверен, верни наиболее вероятный код.""",
    
    'word_analysis': """Дан список слов: {words_list}
Определи, какие слова на изучаемом языке ({learning_language}), а какие на родном языке ({native_language}).
Верни ТОЛЬКО JSON без дополнительного текста в формате: {{"слово_на_изучаемом": "перевод_на_родном"}}
Если слово уже на родном языке, не включай его в результат.""",
    
    'translation': """Переведи следующие слова с {learning_language} на {native_language}: {words_list}
Верни ТОЛЬКО JSON без дополнительного текста в формате: {{"слово": "перевод"}}""",
    
    'german_word_processing': """Обработай немецкое слово '{word}':
1. Если это существительное - добавь правильный артикль (der/die/das) и напиши с заглавной буквы
2. Если это глагол или другое - оставь без артикля, но исправь регистр если нужно
3. Если это предложение или словосочетание (содержит несколько слов) - верни его БЕЗ ИЗМЕНЕНИЙ
Верни ТОЛЬКО обработанное слово без дополнительного текста.""",
    
    'deck_name': """На основе списка слов на {learning_language} сгенерируй 
краткое и понятное название колоды на {native_language}.
Учти категории и тематику слов. Название должно быть коротким (2-4 слова).
Верни ТОЛЬКО название без дополнительного текста.""",
    
    'category': """Определи категорию для списка слов на языке {language}: {words_list}
Верни ТОЛЬКО название категории на {native_language} без дополнительного текста.
Примеры категорий: Еда, Спорт, Природа, Технологии, Одежда, Дом, Транспорт, Животные, Цвета, Числа и т.д.""",
    
    'image_prompt_generation_minimalistic': """Твоя задача — создать МАКСИМАЛЬНО ПРОСТОЕ визуальное описание

для иллюстрации смысла указанного слова, словосочетания или фразы.

Входные данные:

{translation}

Правила (ОБЯЗАТЕЛЬНЫ):

1. НЕ использовать само слово, его перевод, синонимы и однокоренные слова.

2. НЕ использовать текст, буквы, цифры, символы, знаки, надписи, экраны, книги.

3. Использовать 1–2 объекта МАКСИМУМ.

4. Никакого сюжета, никакого фона с деталями.

5. Никаких эмоций, никакой атмосферы, никакой художественности.

6. Изображение должно быть понятно за 1 секунду.

7. Представь, что это пиктограмма или учебная карточка для начинающего.

Как выбирать образ:

- Конкретные объекты → самый узнаваемый ракурс.

- Абстрактные понятия → самый прямой физический эквивалент.

- Фразы → один ключевой элемент, без действия.

Формат ответа:

- 1–2 коротких предложения

- Только перечисление визуальных элементов

- Без пояснений и метафор

Начни сразу с описания.""",
    
    'image_prompt_generation_balanced': """Твоя задача — создать наглядное визуальное описание сцены для иллюстрации,
которая ясно передаёт СМЫСЛ указанного слова, словосочетания или фразы.

Входные данные:

{translation}

Правила (ОБЯЗАТЕЛЬНЫ):

1. НЕ используй само слово, его перевод, синонимы и однокоренные слова.

2. НЕ используй текст, буквы, цифры, символы, надписи, знаки, книги, экраны, плакаты, интерфейсы.

3. Описывай ТОЛЬКО то, что можно изобразить визуально.

4. Сцена должна быть понятной без объяснений и подписей.

5. Избегай аллегорий, где обычно появляется текст (плакаты, лозунги, таблички).

6. Один главный визуальный сюжет, без перегруженности.

7. Нейтральный культурный контекст, универсальный для международного понимания.

8. Подходит для карточки ANKI: просто, ясно, запоминаемо.

Как выбирать сцену:

- Для конкретных объектов → показать сам объект в естественной ситуации.

- Для абстрактных понятий → показать человеческое действие, взаимодействие или состояние.

- Для процессов и фраз → показать момент действия или результат.

- Для сложных философских понятий → использовать простую метафору через физический мир и людей.

Формат ответа:

- 2–4 предложения

- Описательный стиль, без объяснений

- Только визуальная сцена

Начни сразу с описания сцены.""",
    
    'image_prompt_generation_creative': """Твоя задача — создать выразительное, образное визуальное описание сцены,

которая ПЕРЕДАЁТ СМЫСЛ указанного слова, словосочетания или фразы

через метафору, атмосферу или необычную ситуацию.

Входные данные:

{translation}

Правила (ОБЯЗАТЕЛЬНЫ):

1. НЕ использовать само слово, его перевод, синонимы и однокоренные слова.

2. НЕ использовать текст, буквы, цифры, символы, надписи, знаки, экраны, книги.

3. Всё должно быть передано ТОЛЬКО визуально.

4. Допускается художественная метафора, символика, настроение.

5. Сцена должна вызывать ассоциацию, а не буквальное понимание.

6. Один цельный образ, но допускается сложность и глубина.

7. Подходит для запоминания через эмоцию и воображение.

Как выбирать образ:

- Для абстрактных понятий → использовать природу, свет, пространство, движение.

- Для фраз → показать кульминационный момент.

- Для сложных идей → образ «внутреннего состояния», а не внешнего действия.

Формат ответа:

- 3–5 предложений

- Живой, образный язык

- Без объяснений смысла словами

Начни сразу с описания сцены.""",
}


def get_default_prompt(prompt_type: str, image_style: str = 'balanced') -> str:
    """
    Получает заводской промпт по типу
    
    Args:
        prompt_type: Тип промпта (image, audio, word_analysis, и т.д.)
        image_style: Стиль генерации изображения (minimalistic, balanced, creative)
                     Используется только для prompt_type='image'
    
    Returns:
        Заводской промпт или пустая строка, если тип не найден
    """
    if prompt_type == 'image':
        return IMAGE_PROMPTS.get(image_style, IMAGE_PROMPTS['balanced'])
    return DEFAULT_PROMPTS.get(prompt_type, '')


def get_image_prompt_for_style(image_style: str = 'balanced') -> str:
    """
    Получает промпт для генерации изображения по стилю
    
    Args:
        image_style: Стиль генерации (minimalistic, balanced, creative)
    
    Returns:
        Промпт для выбранного стиля или сбалансированный по умолчанию
    """
    return IMAGE_PROMPTS.get(image_style, IMAGE_PROMPTS['balanced'])


def get_image_prompt_generation_for_style(image_style: str = 'balanced') -> str:
    """
    Получает промпт для первого этапа генерации (создание описания через GPT-4o-mini) по стилю
    
    Args:
        image_style: Стиль генерации (minimalistic, balanced, creative)
    
    Returns:
        Промпт для первого этапа выбранного стиля или сбалансированный по умолчанию
    """
    prompt_key = f'image_prompt_generation_{image_style}'
    # Пробуем получить промпт для конкретного стиля
    prompt = DEFAULT_PROMPTS.get(prompt_key)
    if prompt:
        return prompt
    # Fallback: используем старый промпт или balanced
    return DEFAULT_PROMPTS.get('image_prompt_generation', DEFAULT_PROMPTS['image_prompt_generation_balanced'])


def format_prompt(
    prompt_template: str,
    word: str = None,
    translation: str = None,
    language: str = None,
    native_language: str = None,
    learning_language: str = None,
    english_translation: str = None,
    words_list: str = None
) -> str:
    """
    Форматирует промпт, заменяя плейсхолдеры на реальные значения
    
    Args:
        prompt_template: Шаблон промпта с плейсхолдерами
        word: Слово
        translation: Перевод слова
        language: Язык слова
        native_language: Родной язык пользователя
        learning_language: Язык изучения
        english_translation: Английский перевод
        words_list: Список слов (строка)
    
    Returns:
        Отформатированный промпт
    """
    formatted = prompt_template
    
    # Заменяем плейсхолдеры
    replacements = {
        '{word}': word or '',
        '{translation}': translation or '',
        '{language}': language or '',
        '{native_language}': native_language or 'русском',
        '{learning_language}': learning_language or '',
        '{english_translation}': english_translation or translation or '',
        '{words_list}': words_list or '',
    }
    
    for placeholder, value in replacements.items():
        formatted = formatted.replace(placeholder, value)
    
    return formatted

